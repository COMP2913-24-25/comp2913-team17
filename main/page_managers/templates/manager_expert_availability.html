{% extends "base.html" %}

{% block title %}Expert Availability Overview{% endblock %}

{% block content %}
<div class="container mt-4">
  <h1>Expert Availability Overview</h1>
  
  <!-- Tabs for Daily and Weekly Views -->
  <ul class="nav nav-tabs" id="availabilityTab" role="tablist">
    <li class="nav-item">
      <a class="nav-link active" id="daily-tab" data-toggle="tab" href="#daily" role="tab">Daily View</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="weekly-tab" data-toggle="tab" href="#weekly" role="tab">Weekly View</a>
    </li>
  </ul>
  
  <div class="tab-content mt-4" id="availabilityTabContent">
    <!-- Daily View -->
    <div class="tab-pane fade show active" id="daily" role="tabpanel">
      <h2>Today ({{ today.strftime('%A, %b %d, %Y') }})</h2>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Expert</th>
            {% for slot in time_slots %}
              <th>{{ slot.strftime('%H:%M') }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for expert in experts %}
            <tr>
              <td>{{ expert.username }}</td>
              {% set avail = daily_availability[expert.id] %}
              {% for slot in time_slots %}
                {% if avail and avail.status and (slot >= avail.start_time and slot < avail.end_time) %}
                  <td class="bg-success"></td>
                {% else %}
                  <td class="bg-danger"></td>
                {% endif %}
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
      <!-- Optionally, show current time marker (for example, a vertical line or note) -->
      <p>Current time: {{ current_time.strftime('%H:%M') }}</p>
    </div>
    
    <!-- Weekly View -->
    <div class="tab-pane fade" id="weekly" role="tabpanel">
      <h2>Next 7 Days</h2>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Expert</th>
            {% for i in range(7) %}
              {% set day = today + timedelta(days=i) %}
              <th>{{ day.strftime('%a, %b %d') }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for expert in experts %}
            <tr>
              <td>{{ expert.username }}</td>
              {% for i in range(7) %}
                {% set day = today + timedelta(days=i) %}
                {% if weekly_availability[expert.id][day] %}
                  <td class="bg-success"></td>
                {% else %}
                  <td class="bg-danger"></td>
                {% endif %}
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
