{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/home-styles.css') }}">

<div class="container mt-5">
  <h1>Current Auctions</h1>
  {% if items %}
    <div class="row g-4">
      {% for item in items %}
      <div class="auction-grid col-12 col-sm-6 col-md-4 col-lg-3" data-item-id="{{ item.item_id }}">
        <a href="{{ url_for('item_page.index', url=item.url) }}" style="text-decoration: none; color: inherit; display: block; cursor: pointer;">
          <div class="auction-item">
            <div class="auction-image-container">
              {% if item.image %}
                <img class="auction-image img-fluid"
                     src="{{ item.image }}"
                     alt="Image of {{ item.title }}"
                     loading="lazy"
                >
              {% else %}
              <p class="auction-image">Image Pending</p>
              {% endif %}
            </div>
            <div class="auction-info">
              <div class="badges">
                <div class="badge {% if not item.authentication_requests %}bg-secondary
                {% elif item.authentication_requests[0].status == 2 %}bg-success
                {% elif item.authentication_requests[0].status == 3 %}bg-danger
                {% else %}bg-warning{% endif %} p-2"
                >
                {% if not item.authentication_requests %}
                    Not Authenticated
                {% elif item.authentication_requests[0].status == 2 %}
                    Authenticated
                {% elif item.authentication_requests[0].status == 3 %}
                    Declined
                {% else %}
                    Authentication Pending
                {% endif %}
                </div>
              </div>
              <span class="auction-title">{{ item.title }}</span>
              <div>
                {% set highest_bid = item.highest_bid() %}
                {% if highest_bid %}
                  £{{ highest_bid.bid_amount }} <i>{{ item.bids|length }} bids</i>
                {% else %}
                  £0.00 <i>0 bids</i>
                {% endif %}
               </div>
              <div class="auction-end-date">
                <span class="countdown" data-end="{{ item.auction_end.isoformat() }}">{{ item.auction_end.strftime('%y-%m-%d %H:%M') }}</span>
              </div>
            </div>
          </div>
        </a>
      </div>
      {% endfor %}
    </div>
  {% else %}
  <p>No auctions available.</p>
  {% endif %}
</div>

<!-- Scripts -->
<script src="{{ url_for('static', filename='js/home.js') }}"></script>

{% endblock %}

